# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞—É–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ —Å–∞–±–º–∏—Ç–µ (–ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∏–∫—Å–æ–≤)

## –î–∞—Ç–∞: 2024
## –°—Ç–∞—Ç—É—Å: –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –Ω–∏–∂–µ ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## 1. –ß—Ç–æ –º—ã —É–∂–µ –∏—Å–ø—Ä–∞–≤–∏–ª–∏ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ)

### 1.1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã)
- ‚úÖ Listening/Reading submit: –º–µ—Ä–¥–∂ –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è submit (Listening, Reading, Writing)
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è `answersRef.current` –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
- ‚úÖ Firebase: –º—è–≥–∫–∏–π logout –±–µ–∑ –∂—ë—Å—Ç–∫–æ–≥–æ reload –Ω–∞ —Ç–µ—Å—Ç–∞—Ö
- ‚úÖ localStorage: —É–¥–∞–ª–µ–Ω–∏–µ –ü–û–°–õ–ï –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ Auto-submit: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç–æ–≥–æ payload

### 1.2. –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã)
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç payload
- ‚úÖ Writing localStorage —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ `last_updated` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –º–æ–¥–µ–ª–∏
- ‚úÖ `time_taken` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ ListeningTestSession (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ submit)

---

## 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–∏ –∞—É–¥–∏—Ç–µ

### 2.1. –ü—Ä–æ–±–ª–µ–º–∞: FinishWritingSessionView ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Å—å –±–ª–æ–∫

**–§–∞–π–ª:** `backend/core/views.py`, —Å—Ç—Ä–æ–∫–∏ 1593-1686

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
with transaction.atomic():
    try:
        session = WritingTestSession.objects.select_for_update().get(id=session_id, user=user)
    except WritingTestSession.DoesNotExist:
        return Response({'error': 'Session not found'}, status=404)

essays = Essay.objects.filter(user=user, test_session=session)  # ‚ö†Ô∏è –í–ù–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
# ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ç–æ–∂–µ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `transaction.atomic()` –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `select_for_update()`
- –í—Å—è –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ essays, AI scoring, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
- –ï—Å–ª–∏ AI scoring —É–ø–∞–¥—ë—Ç –∏–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –æ—à–∏–±–∫–∞, —Å–µ—Å—Å–∏—è –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –≤ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø (–Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ –æ—Ç–≤–µ—Ç–æ–≤, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
with transaction.atomic():
    try:
        session = WritingTestSession.objects.select_for_update().get(id=session_id, user=user)
    except WritingTestSession.DoesNotExist:
        return Response({'error': 'Session not found'}, status=404)

    essays = Essay.objects.filter(user=user, test_session=session)  # –í–ù–£–¢–†–ò —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    if not essays.exists():
        return Response({'error': 'No essays found for this session'}, status=400)
    # ... –≤–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

---

### 2.2. –ü—Ä–æ–±–ª–µ–º–∞: Reading submit ‚Äî —Ä–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–§–∞–π–ª:** `backend/core/views.py`, —Å—Ç—Ä–æ–∫–∏ 3380-3385

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
session.save(update_fields=['answers', 'time_left_seconds', 'end_time', 'completed', 'last_updated'])

# Trigger result calculation
result = self._calculate_and_save_results(session)  # ‚ö†Ô∏è –í–ù–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

return Response(ReadingTestResultSerializer(result).data, status=status.HTTP_200_OK)
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `_calculate_and_save_results` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–ø–æ—Å–ª–µ** –≤—ã—Ö–æ–¥–∞ –∏–∑ `transaction.atomic()`
- –ï—Å–ª–∏ —Ä–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —É–ø–∞–¥—ë—Ç, —Å–µ—Å—Å–∏—è —É–∂–µ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ `completed`, –Ω–æ `ReadingTestResult` –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω
- –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ—Ç–µ—Ä–∏ –æ—Ç–≤–µ—Ç–æ–≤, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø (–Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ –æ—Ç–≤–µ—Ç–æ–≤, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
with transaction.atomic():
    # ... –≤–µ—Å—å –∫–æ–¥ submit –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ...
    session.save(update_fields=['answers', 'time_left_seconds', 'end_time', 'completed', 'last_updated'])
    
    # Trigger result calculation –í–ù–£–¢–†–ò —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    result = self._calculate_and_save_results(session)

return Response(ReadingTestResultSerializer(result).data, status=status.HTTP_200_OK)
```

---

### 2.3. –ü—Ä–æ–±–ª–µ–º–∞: Listening submit ‚Äî —Ä–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ try-except, –Ω–æ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–§–∞–π–ª:** `backend/core/views.py`, —Å—Ç—Ä–æ–∫–∏ 2506-2539

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
with transaction.atomic():
    # ... –º–µ—Ä–¥–∂ answers ...
    session.save()  # –°–µ—Å—Å–∏—è –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ submitted

# –°—á–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ—Ç–∞–ª—å–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
try:
    results = create_listening_detailed_breakdown(session)  # ‚ö†Ô∏è –í–ù–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    # ... —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ...
except Exception:
    pass  # –ú–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –†–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–ø–æ—Å–ª–µ** –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ï—Å–ª–∏ —Ä–∞—Å—á—ë—Ç —É–ø–∞–¥—ë—Ç, —Å–µ—Å—Å–∏—è —É–∂–µ `submitted`, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç –Ω–µ –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ—Ç–µ—Ä–∏ –æ—Ç–≤–µ—Ç–æ–≤, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø (–Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ –æ—Ç–≤–µ—Ç–æ–≤, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
with transaction.atomic():
    # ... –º–µ—Ä–¥–∂ answers ...
    session.save()
    
    # –°—á–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ—Ç–∞–ª—å–Ω–æ –í–ù–£–¢–†–ò —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    try:
        results = create_listening_detailed_breakdown(session)
        # ... —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ...
    except Exception:
        pass
```

---

### 2.4. –ü—Ä–æ–±–ª–µ–º–∞: Writing auto-submit ‚Äî –Ω–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ submit –∏ localStorage —É–¥–∞–ª—è–µ—Ç—Å—è –î–û –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

**–§–∞–π–ª:** `frontend/src/pages/WritingTaskPage.js`, —Å—Ç—Ä–æ–∫–∏ 193-242

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ submit**: –í `handleTimeUp` (auto-submit) –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `syncDraft()` –ø–µ—Ä–µ–¥ submit. –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π sync –±—ã–ª 11 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ —á—Ç–æ –Ω–∞–ø–∏—Å–∞–ª —Ç–µ–∫—Å—Ç, —Ç–æ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä–µ–¥ auto-submit.
2. **localStorage —É–¥–∞–ª—è–µ—Ç—Å—è –î–û –Ω–∞–≤–∏–≥–∞—Ü–∏–∏**: –í —Ä—É—á–Ω–æ–º submit –º—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏ —ç—Ç–æ, –Ω–æ –≤ `handleTimeUp` (auto-submit) –æ—Å—Ç–∞–ª–æ—Å—å —Å—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –ï—Å–ª–∏ `navigate` —É–ø–∞–¥—ë—Ç, localStorage —É–∂–µ –æ—á–∏—â–µ–Ω.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –í–´–°–û–ö–ê–Ø (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ auto-submit)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û):**
```javascript
const handleTimeUp = async () => {
  // ... –ø—Ä–æ–≤–µ—Ä–∫–∏ ...
  try {
    // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ submit
    try {
      await syncDraft();
    } catch (err) {
      console.error('Failed to sync before auto-submit:', err);
    }

    // ... submit tasks ...

    navigate(`/writing/result/${sessionId}`);

    // ‚úÖ localStorage —É–¥–∞–ª—è–µ—Ç—Å—è –ü–û–°–õ–ï –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    setTimeout(() => {
      localStorage.removeItem(`writing_task1_${sessionId}`);
      localStorage.removeItem(`writing_task2_${sessionId}`);
      localStorage.removeItem(`writing_deadline_${sessionId}`);
    }, 100);
  } catch (err) {
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ...
  }
};
```

---

### 2.5. –ü—Ä–æ–±–ª–µ–º–∞: Writing ‚Äî AI scoring –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å 500, –Ω–æ —Å–µ—Å—Å–∏—è —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**–§–∞–π–ª:** `backend/core/views.py`, —Å—Ç—Ä–æ–∫–∏ 1652-1655

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
try:
    ai_result = ai_score_essay(...)
    # ... —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ AI ...
    essay.save()
except Exception as e:
    essay.feedback = f"AI scoring failed: {str(e)}"
    essay.save()
    return Response({'error': 'AI scoring failed', 'detail': str(e)}, status=500)  # ‚ö†Ô∏è –í–æ–∑–≤—Ä–∞—â–∞–µ–º 500
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ AI scoring —É–ø–∞–¥—ë—Ç, –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 500, –Ω–æ —ç—Å—Å–µ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Å —Ç–µ–∫—Å—Ç–æ–º –æ—à–∏–±–∫–∏
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É, –Ω–æ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –º–æ–∂–µ—Ç —Å–±–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø (–¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è, –Ω–æ UX –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–ª–æ—Ö–∏–º)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 200 —Å —Ñ–ª–∞–≥–æ–º `ai_scoring_failed: true`, —á—Ç–æ–±—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–Ω–∞–ª, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, –Ω–æ AI scoring –Ω–µ –ø—Ä–æ—à—ë–ª

---

### 2.6. –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤

**–§–∞–π–ª:** `frontend/src/api.js`

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```javascript
const api = axios.create({
  baseURL: process.env.REACT_APP_API_BASE_URL || '/api'
});
// –ù–µ—Ç timeout
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–≤–∏—Å–Ω–µ—Ç –∏–ª–∏ —Å–µ—Ç—å –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–∞—è, –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∑–Ω–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
- –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö (sync —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª –æ—Ç–≤–µ—Ç—ã), –Ω–æ –ø–ª–æ—Ö–æ –¥–ª—è UX

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø (–Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –ø–ª–æ—Ö–æ –¥–ª—è UX)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
const api = axios.create({
  baseURL: process.env.REACT_APP_API_BASE_URL || '/api',
  timeout: 30000  // 30 —Å–µ–∫—É–Ω–¥
});
```

---

### 2.7. –ü—Ä–æ–±–ª–µ–º–∞: Writing ‚Äî withRetry –º–æ–∂–µ—Ç –∑–∞—Ü–∏–∫–ª–∏—Ç—å—Å—è –ø—Ä–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö

**–§–∞–π–ª:** `frontend/src/pages/WritingTaskPage.js`, —Å—Ç—Ä–æ–∫–∏ 53-66

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```javascript
const withRetry = async (fn, delays = [0, 500, 1500]) => {
  let lastError;
  for (let i = 0; i < delays.length; i++) {
    if (delays[i]) {
      await new Promise(res => setTimeout(res, delays[i]));
    }
    try {
      return await fn();
    } catch (err) {
      lastError = err;
    }
  }
  throw lastError;
};
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –≤—Å–µ 3 –ø–æ–ø—ã—Ç–∫–∏ —É–ø–∞–¥—É—Ç, –æ—à–∏–±–∫–∞ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—Å—è
- –ù–æ –µ—Å–ª–∏ `fn()` –∑–∞–≤–∏—Å–Ω–µ—Ç (–Ω–µ —É–ø–∞–¥—ë—Ç, –∞ –∑–∞–≤–∏—Å–Ω–µ—Ç), `withRetry` –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
- –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–≤–∏—Å–∞–Ω–∏—é UI

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø (–Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–≤–∏—Å–∞–Ω–∏—é UI)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞ `fn()` –≤–Ω—É—Ç—Ä–∏ `withRetry`

---

## 3. –ò—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

**–í—ã—Å–æ–∫–∏–µ (–º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö):**
1. ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**: Writing auto-submit ‚Äî –Ω–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ submit –∏ localStorage —É–¥–∞–ª—è–µ—Ç—Å—è –î–û –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

**–°—Ä–µ–¥–Ω–∏–µ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏):**
1. ‚ö†Ô∏è FinishWritingSessionView ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Å—å –±–ª–æ–∫
2. ‚ö†Ô∏è Reading submit ‚Äî —Ä–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. ‚ö†Ô∏è Listening submit ‚Äî —Ä–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
4. ‚ö†Ô∏è Listening/Reading auto-submit ‚Äî —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ sync (–¥–æ–±–∞–≤–ª–µ–Ω retry)

**–ù–∏–∑–∫–∏–µ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –ø–ª–æ—Ö–æ –¥–ª—è UX):**
5. ‚ö†Ô∏è Writing ‚Äî AI scoring –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å 500, –Ω–æ –¥–∞–Ω–Ω—ã–µ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
6. ‚ö†Ô∏è –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
7. ‚ö†Ô∏è Writing ‚Äî withRetry –º–æ–∂–µ—Ç –∑–∞—Ü–∏–∫–ª–∏—Ç—å—Å—è –ø—Ä–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–∏

---

## 4. –í—ã–≤–æ–¥—ã

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ—Ç–µ—Ä–µ–π –æ—Ç–≤–µ—Ç–æ–≤, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
- ‚úÖ Submit –±–æ–ª—å—à–µ –Ω–µ —Å—Ç–∏—Ä–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã (–º–µ—Ä–¥–∂)
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç race conditions
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç ref –∏ state
- ‚úÖ Firebase –Ω–µ –¥–µ–ª–∞–µ—Ç –∂—ë—Å—Ç–∫–∏–π reload –Ω–∞ —Ç–µ—Å—Ç–∞—Ö
- ‚úÖ localStorage —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö, –≤–∫–ª—é—á–∞—è auto-submit)
- ‚úÖ **Writing auto-submit —Ç–µ–ø–µ—Ä—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –ø–µ—Ä–µ–¥ submit**
- ‚úÖ **Listening/Reading auto-submit —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ sync (–¥–æ–±–∞–≤–ª–µ–Ω retry)**

**–û—Å—Ç–∞–ª–∏—Å—å —Å—Ä–µ–¥–Ω–∏–µ/–Ω–∏–∑–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ä–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, AI scoring) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚ö†Ô∏è –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤

**–≠—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã –ù–ï –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –ø–æ—Ç–µ—Ä–µ –æ—Ç–≤–µ—Ç–æ–≤**, –Ω–æ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (—Å–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ—Ç)
- –ü–ª–æ—Ö–æ–º—É UX (–∑–∞–≤–∏—Å–∞–Ω–∏–µ UI, –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (1-3) –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.
